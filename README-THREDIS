
Thredis
-------

Thredis is threaded Redis. (Apparently "thredis" is also "ribbons" in
Scots). At this point it is work-in-progress ALPHA quality, probably
contains many bugs and in need of much improvement, but should be
sufficient as proof-of-concept to toy around with. Use at your own
risk.

Thredis is for the most part identical to Redis. We did rename the
executable to thredis-server so that it looks different from
redis-server when running ps, etc.


Problem

If you're using Redis for complex operations (such as big ZUNION
operations), the server can block for a long time and only uses one
core. It would be nice if other operations could take place
concurrently, using many cores.

Solution

Certain commands (the ones that are obviously O(N) or more) are
submited to their own threads.

How / implications

Clearly this requires locking. The total number of locks required is
equal to the number of clients + one per every db + a global server
lock. Every operation requires checking the hash of locked keys, which
makes everything slower. Also, determinism is impossible with
concurrency, therefore you should NEVER use Thredis as a master - your
slaves will have a different database from the master.

Getting started

You probably want start out by trying the thredis-2.6 branch. It is
based on a stable Redis release.


Performance
-----------

The most striking performance gain can be observed on SMP systems when
running time-consuming operations. In a simple experiement, 20 clients
running a ZUNIONSTORE operation on 25 Sorted Sets of 100,000 random
entires took 61.79s on single-threaded Redis versus 6.30s on
Thredis. This test was conducted on a 24-core server. This is a more
than 980% (or almost 10x) performance improvement!

For simple O(1) or similar operations Thredis is slightly slower than
Redis. Simple operations are not submitted to separate threads and run
in the main event loop, just like Redis, but locking still has to be
done, which is where most of the slowdown happens.

Here is the output of a redis-benchmark -n 10000 run comparing Redis
2.6 with Thredis 2.6 on the same machine (4-core Linux in a VirtualBox
on a MacBook Pro):

                                        Redis        Thredis
PING_INLINE                             44444.45     45454.55  102.27%
PING_BULK                               48543.69     45248.87   93.21%
SET                                     44843.05     41666.67   92.92%
GET                                     48780.49     44444.45   91.11%
INCR                                    46948.36     37878.79   80.68%
LPUSH                                   46296.30     36900.37   79.70%
LPOP                                    45454.55     40816.33   89.80%
SADD                                    48309.18     40485.83   83.81%
SPOP                                    48309.18     40322.58   83.47%
LPUSH (needed to benchmark LRANGE)      46511.63     41493.78   89.21%
LRANGE_100 (first 100 elements)         29761.90     23148.15   77.78%
LRANGE_300 (first 300 elements)         14367.82     13947.00   97.07%
LRANGE_500 (first 450 elements)         10615.71     10471.20   98.64%
LRANGE_600 (first 600 elements)         8230.45      8110.30    98.54%
MSET (10 keys)                          27322.40     21739.13   79.57%
                                                       AVERAGE: 89.18%

